##### 0806

创建模型功能完整表映射。

sqlalchemy 每张表必须定义主键， 否则无法映射。

```
Mapper Mapper|User_Model_Type|user_model_type could not assemble any primary key columns for mapped table 'user_model_type' # 此错误极有可能就是没有主键引起的
```

string 类型必须设置长度。

外键设置出错， 无法创建外键表：Cannot add foreign key constraint。

``` python
# 从sqlalchemy 中导入ForeignKey
# 从sqlalchemy 中导入relationship
# 在每张表后面增加一个字段使用relationship

name = relationship('建立的类名')

# 在关联表中 使用ForeignKey

name = Column(Integer, ForeignKey('数据库表名.关联字段名称'))
# 无法迁移。
```

手动创建外键， 在数据库中增加。

编写数据获取流程，返回初始查询数据。

添加路径测试， 出现无法加载情况。jupyterlab 页面停留在启动页面， 无法加载内容。



##### 0807

下载notebook 源码， 对比操作。

删除生成的静态文件， schemas, staging  中的no_model以及build文件，static目录。 在此执行启动， 生成文件，就可以进入了。

修改代码错误， 测试数据。调整数据返回结构。



```
# 添加子类进入父类。
	...: for child_type in child_list:
    ...:     child_dict = []
    ...:     
    ...:     if f_type.TID == child_type.Father_ID:
    ...:         child_dict.append({'child_id': child_type.TID, 'child_name': child_type.Type_name})
    ...:         t_dict[child_type.Father_ID]['child'].append(child_dict)
    ...: print(child_dict)
    ...: print(t_dict)

```

##### 0808

添加完成model 类型接口。 返回数据。

完成gitlab 使用文档。详情见--》 gitlab.md



##### 0809

测试模型添加接口， 未完成。

gitlab 功能大概实例， 文档扩展。

gitlab 数据定时备份。

```
gitlab-rake gitlab:backup:create
使用以上命令会在/var/opt/gitlab/backups目录下创建一个名称类似为1393513186_gitlab_backup.tar的压缩包, 这个压缩包就是Gitlab整个的完整部分, 其中开头的1393513186是备份创建的日期.

Gitlab 修改备份文件默认目录
你也可以通过修改/etc/gitlab/gitlab.rb来修改默认存放备份文件的目录:

gitlab_rails['backup_path'] = '/mnt/backups'
/mnt/backups修改为你想存放备份的目录即可, 修改完成之后使用gitlab-ctl reconfigure命令重载配置文件即可.

Gitlab 自动备份
也可以通过crontab使用备份命令实现自动备份:

sudo su -
crontab -e
加入以下, 实现每天凌晨2点进行一次自动备份:

0 2 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create
Gitlab 恢复
同样, Gitlab的从备份恢复也非常简单:

# 停止相关数据连接服务
gitlab-ctl stop unicorn
gitlab-ctl stop sidekiq

# 从1393513186编号备份中恢复
gitlab-rake gitlab:backup:restore BACKUP=1393513186

# 启动Gitlab
sudo gitlab-ctl start
```

https://www.zhihu.com/question/19634226

http://wiki.mbalib.com/wiki/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90

https://www.jianshu.com/p/48178ce12934

https://blog.csdn.net/qq_41787597/article/details/79448117

https://www.zhihu.com/question/19735039

简单描述指标库功能



##### 0810

服务器全面崩溃， redmine, gitlab， 宿主机， vnc全部链接不上。

重启连接时出现以下内容：

```
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the ECDSA key sent by the remote host is
SHA256:lIxdb4NQ2AdA2TyEYkNLssaU2cx+kjVrSvVCCU0/ZDM.
Please contact your system administrator.
Add correct host key in /home/sunxr/.ssh/known_hosts to get rid of this message.
Offending ECDSA key in /home/sunxr/.ssh/known_hosts:3
  remove with:
  ssh-keygen -f "/home/sunxr/.ssh/known_hosts" -R "192.168.3.172"
ECDSA host key for 192.168.3.172 has changed and you have requested strict checking.
Host key verification failed.
```

按照以上操作`ssh-keygen -f "/home/sunxr/.ssh/known_hosts" -R "192.168.3.172"`

出现以下内容：

```
# Host 192.168.3.172 found: line 3
/home/sunxr/.ssh/known_hosts updated.
Original contents retained as /home/sunxr/.ssh/known_hosts.old
# 更新连接key
```

再次连接即可，不过ssh目录下的私钥和公钥就没了。

###### 配置gitlab 邮箱

gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.yhist.com"
gitlab_rails['smtp_port'] = 587
gitlab_rails['smtp_user_name'] = "redmine@yuist.com"
gitlab_rails['smtp_password'] = "YUhan!@#"
gitlab_rails['smtp_domain'] = "smtp.yhist.com"
gitlab_rails['smtp_authentication'] = "login"

https://www.zhihu.com/question/20640649



复制配置文件etc中：

sudo cp /usr/share/redmine/config/configuration.yml.example /etc/redmine/default/configuration.yml

编辑配置文件：sudo vim /etc/redmine/default/configuration.yml 

```
default:
  # Outgoing emails configuration
  # See the examples below and the Rails guide for more configuration options:
  # http://guides.rubyonrails.org/action_mailer_basics.html#action-mailer-configuration
  email_delivery:
    delivery_method: :async_smtp
    smtp_settings:
      address: "smtp.yhist.com"
      port: 587
      domain: "smtp.yhist.com"
      authentication: :login
      user_name: redmine@yhist.com
      password: "YUhan!@#"
```

重启apache2， redmine使用运行apache2上面， 重启apache2就是重启redmine。

重启postfix 邮件服务。 `sudo service postfix restart`

登录redmine， 进入配置文件， 配置邮箱设置保存。

